{% from "toc/_form.html" import dynamic_fields %}

{% extends "base.html" %}

{% block head %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/toc.css') }}" />
  <script src="{{ url_for('static', filename='js/jquery-3.3.1-min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/knockout-3.4.2-min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/knockout.mapping-2.4.1-min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/knockout.validation-2.0.3-min.js') }}"></script>
{% endblock %}

{% block content %}
  <h2>Trail of Cthlulu</h2>
  <form action="/toc" method="POST">
    <ol>
      <li>
        <label for="player">Player</label>
        <input type="text" id="player" data-bind="value: player" />
      </li>
      <li>
        <label for="name">Name</label>
        <input type="text" id="name" data-bind="value: name" />
      </li>
      <li>
        <label for="age">Age</label>
        <input type="number" id="age" data-bind="value: age" />
      </li>
      <li>
        <label for="name">Nationality</label>
        <input type="text" id="nationality" data-bind="value: nationality" />
      </li>
      <li>
        <select
          name="occupation"
          data-bind="options: occupations,
                optionsText: 'name',
                value: occupation"></select>
      </li>
    </ol>

    <fieldset>
      <legend>Stats</legend>
      <ol>
        <li>
          <label for="health">Health</label>
          <input type="number" id="health" min="1" max="12" data-bind="value: health" />
        </li>
        <li>
          <label for="stability">Stability</label>
          <input type="number" id="stability" min="1" max="12"
                 data-bind="value: stability" />
        </li>
        <li>
          <label for="sanity">Sanity</label>
          <input type="number" id="sanity" min="4" max="10"
                 data-bind="value: sanity" />
        </li>
        <li>
          <label for="hitthreshold">Hit Threshold</label>
          <input type="number" id="hitthreshold" readonly />
        </li>
      </ol>
    </fieldset>

    <fieldset>
      <legend>Abilities</legend>

      <fieldset>
        <legend>Investigative</legend>
        <!-- ko foreach: investigativeCategories -->
        <fieldset>
          <legend data-bind="text: name"></legend>
          <ul data-bind="template: {name: 'ability-template', foreach: abilities}"></ul>
        </fieldset>
        <!-- /ko -->
      </fieldset>

      <fieldset>
        <legend>General</legend>
        <ul data-bind="template: {name: 'ability-template',
                       foreach: abilities().filter(a => a.category[0] == 'general')}"></ul>
      </fieldset>

    </fieldset>

    <fieldset>
      <legend>Character</legend>

      <ol>
        <li>
          <label for="name">Drive</label>
          <input type="text" id="drive" data-bind="value: drive" />
        </li>
        <li>
          <label for="suspicion">Suspicion</label>
          <input type="number" data-bind="value: suspicion" />
        </li>
      </ol>

      {{ dynamic_fields("sourcesOfStability", "Sources of Stability", "Source of Stability") }}
      {{ dynamic_fields("pillarsOfSanity", "Pillars Of Sanity", "Pillar Of Sanity") }}
      {{ dynamic_fields("contacts", "Contacts", "Contact") }}

    </fieldset>

    {{ dynamic_fields("inventory", "Inventory", "Inventory Item") }}

    <input type="submit" value="Submit" data-bind="click: submit" />

  </form>

  <script type="text/html" id="ability-template">
    {% include "toc/_ability_template.html" %}
  </script>

  <script src="{{ url_for('static', filename='toc/app.js' )}}"></script>
{% endblock %}
